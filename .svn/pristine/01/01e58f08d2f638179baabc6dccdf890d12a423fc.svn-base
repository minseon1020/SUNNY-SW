import React, { useState } from "react";

export default function EnergyFetch() {
  const [cityId, setCityId] = useState("");
  const [countyId, setCountyId] = useState("");
  const [energy, setEnergy] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  const handleFetch = () => {
    if (!cityId && !countyId) {
      alert("cityId ë˜ëŠ” countyId ì¤‘ í•˜ë‚˜ ì´ìƒì€ ì…ë ¥í•´ì£¼ì„¸ìš”!");
      return;
    }

    setLoading(true);
    setError(null);

    //  íŒŒë¼ë¯¸í„°ë¥¼ ì¡°ê±´ë¶€ë¡œ ì¶”ê°€
    let params = [];
    if (cityId) params.push(`cityId=${cityId}`);
    if (countyId) params.push(`countyId=${countyId}`);

    const queryString = params.join("&");
    const url = `/api/energy?${queryString}`;

    console.log("ìš”ì²­ URL:", url);

    fetch(url)
      .then((res) => {
        if (!res.ok) throw new Error("ìš”ì²­ ì‹¤íŒ¨");
        return res.json();
      })
      .then((data) => {
        console.log("ì„œë²„ ì‘ë‹µ:", data);
        setEnergy(data);
      })
      .catch((err) => {
        console.error("ì—ëŸ¬:", err);
        setError(err.message);
      })
      .finally(() => setLoading(false));
  };

  return (
    <div
      style={{
        padding: "30px",
        background: "#fffbea",
        borderRadius: "16px",
        maxWidth: "600px",
        margin: "40px auto",
        boxShadow: "0 2px 10px rgba(0,0,0,0.1)",
      }}
    >
      <h2 style={{ marginBottom: "20px", fontWeight: "700" }}>
        âš¡ ì—ë„ˆì§€ ë°ì´í„° ìš”ì²­ (cityId + countyId)
      </h2>

      {/* cityId ì…ë ¥ */}
      <div style={{ marginBottom: "15px" }}>
        <label>ğŸ™ï¸ cityId: </label>
        <input
          type="text"
          placeholder="ì˜ˆ: 11"
          value={cityId}
          onChange={(e) => setCityId(e.target.value)}
          style={{
            padding: "8px",
            borderRadius: "8px",
            border: "1px solid #ccc",
            width: "150px",
          }}
        />
      </div>

      {/* countyId ì…ë ¥ */}
      <div style={{ marginBottom: "25px" }}>
        <label>ğŸ“ countyId: </label>
        <input
          type="text"
          placeholder="ì˜ˆ: 101"
          value={countyId}
          onChange={(e) => setCountyId(e.target.value)}
          style={{
            padding: "8px",
            borderRadius: "8px",
            border: "1px solid #ccc",
            width: "150px",
          }}
        />
      </div>

      <button
        onClick={handleFetch}
        style={{
          background: "#facc15",
          padding: "10px 20px",
          borderRadius: "8px",
          border: "none",
          cursor: "pointer",
          fontWeight: "600",
        }}
      >
        ìš”ì²­ ë³´ë‚´ê¸° ğŸš€
      </button>

      {loading && <p>ğŸ“¡ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>}
      {error && <p style={{ color: "red" }}>âŒ ì—ëŸ¬: {error}</p>}

      {energy && (
        <div
          style={{
            marginTop: "25px",
            background: "#fff",
            padding: "20px",
            borderRadius: "12px",
            boxShadow: "0 2px 6px rgba(0,0,0,0.1)",
          }}
        >
          <h3 style={{ marginBottom: "10px" }}>ğŸ“Š ì„œë²„ ì‘ë‹µ ë°ì´í„°</h3>
          <p>
            <b>ğŸ™ï¸ cityId:</b> {energy.cityId}
          </p>
          <p>
            <b>ğŸ“ countyId:</b> {energy.countyId}
          </p>
          <p>
            <b>âš¡ ì „ê¸° ì‚¬ìš©ëŸ‰:</b> {energy.electricUsage}
          </p>
          <p>
            <b>ğŸ”¥ ê°€ìŠ¤ ì‚¬ìš©ëŸ‰:</b> {energy.gasUsage}
          </p>
        </div>
      )}
    </div>
  );
}
